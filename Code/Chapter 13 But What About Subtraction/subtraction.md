如何实现减法
============

继电器连接到一起也可以实现减法。加法和减法在某些方面可以相互补充，但机制又不同。加法是进位机制，而进发是借位机制——一种与加法存在本质区别的麻烦机制。故可以大体上用加法实现减法，但细节上又有些不同。

我么打算用一个小技巧让减法不涉及借位。

### 实现减法的算法

为了便于表达，将进行减法的两个数分别用于被减数（minuend)和减数（subtrahend）表示。从被减数中减去减数，得到的结果叫做差（difference）。



为了避免借位，首先从999减去减数。



这叫对9求补数。这样的好处是无论减数是多少，计算对9的补数都不需要借位。

计算出减数对9的补数后，将补数与原来的被减数相加。



最后再将结果加1，并减去1000.



到此就得到差，而且没有用到错位。

我们用两个减法和两个加法来替代一个减法，而这个过程中避免了繁琐的错位。

#### 减数大于被减数的情况

要解决这个问题而不使用借位的话， 就要采用与之前稍微不同的方法。首先要像前面一样，用999减去减数，计算出对9的补数：



把该数对9的补数与被减数相加：



由于之前已经加了999，这里再减去999：



到这里，意识到这个问题的结果是个负数，因此我们需要将减数与被减数交换。这里没有用到错误，结果也与我们期望相同：



同样的技巧可以用于二进制数中，让我们来看看如何操作。

问题变为：



第一步，用11111111减去减数：



我们发现在对1求补数的时候，只需将原来的二进制数中的1变为0，将0变为1即可。因此对1求补数有时也称为相反数（negation）或反码（inverse）。这里你可能会想到第11章的反向器，它的作用就是将0变为1，将1变为0.

第二步，将减数对1的补数与被减数相加。



第三步，将上式所得到的结果加1：



第四步，减去1000000000:



结果就等于十进制的77.

我们把这两个数颠倒位置后再做一遍。



第一步，用11111111减去简述好，得到对1的补数：



第二步，将jain 苏对1的补数与被减数相加：



现在我们用第二步得到的结果对1求补数：



这个结果是77，而真正的档案应该是-77.

### 加/减法器

到这里，我们已经有了足够的条件来改造上一章所搭建的加法器，并让它像实现加法一样来实现减法运算。为了不让问题太复杂，这个新的加/减法器只执行在减数小于被减数的减法操作，即结果为正数的操作。

该加法器的核心是由逻辑门集成的8位加法器。



8位加/减法器所用的新面板较从前做了些许的改动。它增设了一个开关，用以选择做加法还是减法。



如上图所示，这个开关向下断开时表示选择加法运算，反之向上接通则表示选择减法运算。此外，右侧的8个灯泡用于表示计算结果。这里，第9个灯泡表示“上溢/下溢”。如果在加法运算中结果大于255（上溢，overflow）或在减法中结果是负数（下溢，underflow）这个灯泡就会发光。

加法器中新增的主要部分就是一个用来求8位二进制数对1补数的电路。二进制数对1求补数相当于对其每位取反，因此可以用8个反向器实现这个功能。



问题是，该电路只对输入求反，而我们要的是一台既能做加法又能做减法的机器，因此就要求该电路但且仅当进行减法运算时才实现反转。电路可以改造为如下图所示。



标记为“取反”的信号将被输入到每一个异或门中。回想一下异或门的工作方式如下表所示。



可以看出，在异或门中，“取反”信号是0，则8个异或门输出与输入相同。如果取反信号为1，则输出信号反置。

将8个异或门合并起来画成一个器件，称为求补器（One's Complement).



将一个求补器，一个8位二进制加法器和一个异或门做如下连接。



> 注意，这里三个信号都标识为“SUB”，这就是加/减法转换开关。求补器位置的“SUB”置0表示加法运算，置1表示减法运算。此外，在做减法时，通过设定CI（进位输入）为1来使得结果加1.而在加法中，求补器不起作用，且输入CI为0.

> 加法器的SUB信号和CO（进位输出）输出作为异或门的输入来控制表示上溢/下溢的灯泡。如果SUB信号为0（表示进行加法运算），则当加法器CO输出为1时灯亮，意思是加法计算结果大于255.

> 当进行减法运算的时候，如果被减数大于减数，则CO端正常输出为1。由于是减法运算，SUB信号为1，通过异或门，上溢/下溢输出为0，这表示在减法的最后一步中减去100000000.


