定点数和浮点数
=============

在计算机存储器中，整数和分数之间的转换并不是这么随意。现在我们应该清楚，计算机中的一切数据都是以位的形式存储的，这就意味着所有的数都表示为二进制形式。但另一个不可否认的事实是，某些类型的数比其他类型更容易用位的形式来表示。

### 整数

我们将从整数的二进制表示开始，这里的整数被数学家称作“自然数”（positive whole number），即计算机程序员口中的“正整数”（positive integers），之后将介绍如何利用2的补数来表示“负整数”（negative integers），该方法可以让正数和负数的相加变得非常简单。下面的表格列出了8位，16位，32位二进制数所能表示的正整数及其2的补数的范围。

| 数的位数 | 正整数的范围    | 整数的2的补数范围            |
| -------- | -----------     | ----------------             |
| 8        | 0~255           | -128~127                     |
| 16       | 0~65 535        | -32 768~32 767               |
| 32       | 0~4 294 967 295 | -2 147 483 648~2 147 483 647 |

我们所要介绍的整数部分就是这样。

### 有理数

除此之外，数学家还定义了用两个整数的比值表示的一类数，称作有理数（rational number）或分数（fraction）。例如3/4是一个有理数，因为它是整数3和4的比。我们也可以把3/4表示成十进制小数的形式，即0.75.尽管我们可以把它写成十进制书的形式，但它实际上代表一个分数，即75/100.

如第7章所述，在十进制数字系统中，小数点左边的数的每一位都和10的正整数次幂相关，而其右边的数的每一位都和10的负整数次幂相关。我们在第7章用到了42705.684这个实例，现在，我们把它表示为以下等价形式：

```
4 x 10000 +
2 x 1000 +
7 x 100 +
0 x 10 +
5 x 1 +
6 / 10 + 
8 / 100 +
4 / 1000
```
上面的除号表示了该位置的数与10的负整数次幂相关的情况，用下面的表达方式可以用除号：

```
4 x 10000 +
2 x 1000 +
7 x 100 +
0 x 10 +
5 x 1 +
6 x 0.1 + 
8 x 0.01 +
4 x 0.0010
```
最后，我们将该数表示为10的幂的形式：

```
4 x 10^4 +
2 x 10^3 +
7 x 10^2 +
0 x 10^1 +
5 x 10^0 +
6 x 10^-1 + 
8 x 10^-2 +
4 x 10^-3
```
有一些有理数很难表示成小数，最明显的一个例子是1/3，如果用3来除1，会得到这样的结果：

```
0.33333333333333...
```
尽管如此，把1/3表示为小数还不是很方便，但它毕竟是一个有理数，因为在本质上它是两个整数的比。类似的，1/7可以表示为：

```
0.142857142857142857......
```

### 无理数

无理数（irrational number）是一些更加奇特的数，如2的平方根等。它们不能表示为两个整数的比，这就意味着其小数部分是无穷的，而切毫无规律，没有循环，例如：

```
√2 = 1.414213562373095...
```
下面这个数学方程式的正数解就是2的平方根：

```
x*x - 2 = 0
```
如果某个数不是任何以整数为系数的代数方程的解，那么这个数称作超越数（transcendental，所有的超越数都是无理数，但是反之不成立）。π就是一个典型的超越数，它是周长与其直径的比值，可以近似的表示为：

```
3.14159265359...
```

### 虚数

目前我们所讨论过的所有数——有理数和无理数——统称为实数（real numbers）。使用实数定义它们的目的是为了将其与虚数（imaginary numbers）区别开来，虚数是负数的平方根。实数和虚数一起构成了复数（complex numbers）。不管名称如何，它们都有重要的作用，例如，虚数确实存在于现实世界，它在解决电子学的某些高级问题中有重要应用。

### 二进制表示小数

小数也可以表示为二进制数吗？当然可以，最简单的方法可能就是使用BCD码（二进制编码的十进制数）。如第19章所述，BCD码是将十进制数以二进制的形式进行编码，0～9之间的每一个数都需要用4位来表示，如下表所示。

| 十进制数字 | BCD代码  |
| ---------- | -------- |
| 0          | 0000     |
| 1          | 0001     |
| 2          | 0010     |
| 3          | 0011     |
| 4          | 0100     |
| 5          | 0101     |
| 6          | 0110     |
| 7          | 0111     |
| 8          | 1000     |
| 9          | 1001     |

BCD编码在程序处理用美元和美分表示的钱款，账户时特别有用。银行和保险公司时非常典型的两类整日与钱打交道的机构，这些机构所使用的计算机程序中，大多数小数所占用的存储空间仅仅相当于两个十进制数所占用的位数。

通常把两个BCD数字放在一个字节，这种方式称为压缩BCD（packed BCD）。由于2的补数不和BCD数一起使用，因此压缩BCD通常需要增加1位用来标识数的正负，该位被称作符号位（sign bit）。用一整个字节保存某个特定的BCD数是很方便的，但要为这个短小的符号位牺牲4位或8位的存储空间。

让我们来看一个例子，假设计算机程序所要处理的钱款数目在+/-100万美元之间，这就意味着，需要表示的钱的数目的范围是-9 999 999.99~99 999 999.99,因此保存在存储器中的每一笔钱的金额都需要5个字节。因此，-4 325 120.25 可以表示为下面5个字节：

```
00010100 00110010 01010001 00100000 00100101
```
将每个字节转换成十六进制数，上面的数可以等价地表示成：

```
14h 32h 51h 20h 25h
```
> 注意，最左边的半个字节所构成的1用来指明该数是负数，这个1即符号位。如果这半个字节所构成的数是0，则说明该数是正数。组成该数的每一个数字都需要用4位来表示，从十六进制的表示形式中可以很直观地看到这一点。

如果要表示的数的范围扩大到－99 999 999.99～99 999 999.99，则我们需要用6个字节来实现，其中5个字节用来表示10个数字，另一个字节整个用来做符号位。

### 定点格式

这种基于二进制的存储和标记方式也别称作定点格式（fixed-point format), 所谓的“定点”是指小数点的位置总是在数的某个特定位置——在本例中，它位于两位小数之前。值得注意的是，有关小数点位置的计数信息并没有与整个数字一起存储。所以，使用定点小数的程序必须知道小数点的位置。你可以设计有任意小数位的定点小数，并且可以在程序中混合使用它们，但程序中对这些数进行算数运算的部分都需要知道小数点的位置，这样才能正确地对其做各种运算处理。

