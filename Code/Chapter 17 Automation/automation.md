自动操作
=======

我们要设计一个更加先进的机器，目标是使加减法的过程自动化。同时这个机器用途非常广泛，因为它可以解决所有用加减法处理的问题，而事实上现实中的很多问题都可以用加法与减法解决。

本章的末尾我们将会设计出一种机器，我们可以称它为计算机（Computer）。

### 电平触发与边沿触发

回忆我们曾在第14章讨论过的一个加法器。这个版本的加法器包括一个8位锁存器，用于对8个开关的输入数据进行迭代求和。下面是其结构图。



从图中可以看出，8位锁存器利用触发器来保存8位数据。使用这个设备时，首先需要按下清零开关使锁存器中的内容全部都变为0，然后通过开关输入第一个数。加法器只是简单地将这个数字和锁存器输出的0进行求和，因此相加的结果与原先输入的数字是一样的。按下相加开关可以把这个数保存在锁存器中，最后会点亮某些灯泡以显示它。现在通过开关输入第二个数，加法器把它与已经存放在锁存器中的第一个数相加。再次按下相加开关，九可以把相加的结果存入锁存器中，并通过灯泡显示这个结果。通过这种方式，可以把一串数相加并显示运行结果。显然，这种设计方案存在一个缺陷：8个灯泡无法显示大于255的数。

对于第14章所介绍的这种电路，目前为止只讲到了一种锁存器，它是电平触发（level triggered）的。在电平触发的锁存器中，为了保存数据必须将时钟输入端首先置1，然后回置为0.当时钟输入端为1时，锁存器的数据输入端可以改变，而这些变化将会影响数据输出。在第14章的后半部分还介绍了边沿触发（edge-triggered)的锁存器，这种锁存器在时钟输入从0跳变为1的瞬间保存数据。边沿触发器在很多方面更加易于使用。因此假定本站用到的所有触发器都是边沿触发的。

### 累加器与64x8 RAM组合

用来累加多个数的锁存器称为累加器(accumulator).

很显然，上面的加法器存在着一个很大的缺陷：假如要把100个二进制数加起来，你必须端坐于加法器前，并且耐心地输入所有的数并累加起来。如果在这段过程中有两个数输错了，你只能重复一遍所有的工作。

但是，也许并非如此。在前一章我们使用了大约500万个继电器构造了一个64KB的RAM阵列。除此之外，我们还把一个控制面板连接到电路帮助我们工作，闭合它的控制（Takeover）端开关后，就可以使用其他开关来控制RAM阵列的读写了。下面是64KB RAM阵列结构图。




现在我们改进累加器，让它不仅仅做简单的累加，还能充当锁存器的角色，保存一个数，并且和下一个数做加法或减法运算。

如果我们把这100个二进制数输入到RAM阵列中而不是直接输入到加法器中，一旦需要修改一些数据，我们的工作将会变得容易得多。

因此我们现在所面临的挑战是如何把RAM阵列和累加器连接起来。很显然，RAM阵列的输出信号可以代替加法器的开关。16位的计数器就可以控制RAM阵列的地址信号。这个电路图中，RAM的数据输入信号和写操作端信号省去。修改后的电路结构如下图所示。



当然，这并不是迄今发明的最易于使用的计算设备。要使用它，首先要闭合清零开关，这样做的目的是，清除锁存器中的内容并把16位计数器的输出置为0000h，然后闭合RAM控制面板的控制端开关。现在你就可以从地址0000h开始输入一组你想要相加的8位数。如果有100个数，那么它们将被存放在0000h~0063h的地址空间中(也应该把RAM阵列中未使用的单元设置为00h).然后闭合RAM控制面板的控制开关(这样控制面板就不再控制RAM阵列了),同时断开清零开关。做完了这些，我们可以静静地坐下来，观察灯泡显示运算结果。

让我们来看一下它是如何工作的。

当清零开关第一次断开时，RAM阵列的地址输入是0000h。RAM阵列的该地址中存放的8位数值是加法器的输入数据。加法器的另一个输入数据为00h，因为此时锁存器也已经清零了振荡器提供的时钟信号——一个可以在0，1之间快速切换的信号。清零开关断开后，时钟信号由0跳变为1时，将有两件事同时发生: 锁存器保存加法器的计算结果，同时16位计数器增1，指向下一个地址单元。当时钟发生第二次跳变时，锁存器保存之前两个数的求和结果，同时计数器增加为0002h；按这种方式往复操作。

> 要注意的是，这里首先做了一些假设。最主要的一点就是，振荡器要足够慢以使电路的其他部分可以工作。

这个电路存在的一个缺陷是：我们没有办法使它停下来。当RAM阵列的剩余部分存放的数都是00h时，灯泡停止发光，我们才可以读取二进制运算的结果。

这个加法器还存在一个问题：它只能做加法运算，并且只能做8位数的加法。尽管可以用2的补数表示负数，但是加法器能处理的数字范围被限制在－128到127之间。要处理更大的数，比如16位数，一个简单的方法是：把RAM阵列，加法器，锁存器的位宽全部加倍，同时增加8个灯泡。但这些投资在我们看来是不合算的。



