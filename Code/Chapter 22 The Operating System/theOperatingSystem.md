操作系统
=======

现在我们拥有一块微处理器，一些随机访问存储器，一款键盘，一台视频显示器和一个磁盘驱动器。我们将这些计算机所拥有的部件组装起来，伸手给它上电。

当阴极射线管加热之后，一串排列整齐——而又完全随机的——ASCII码字符阵列出现在屏幕上。不出我们所料，掉电的时候，半导体存储器中的内容就会被全部清零；而再一次打开电源时，屏幕上的ASCII又以随机的排列出现。

这里我们缺少的是软件。当微处理器加电或复位时，它会执行内存中某个地址里存放的机器代码。对8080来说，这个地址是0000h。对正确的计算机来说，加电时，该地址处应该有一个机器代码指令。

### 机器代码指令如何存放到内存初始位置的

在新设计的计算机中，把软件放到合适地方的处理过程可能是最令人费解的。要理解它，先从控制面板着手。该控制面板和第16章讲到的用来写入字节到随机访问存储器然后再读取出的控制面板相似。



与以前的控制面板不同的是，这个控制面板有一个标明为复位的开关，这个开关连接到微处理器的复位输入，只要这个开关是闭合的，处理器就什么都不做；当断开这个开关后，微处理器就开始执行机器码。

控制面板的使用方法是：复位开关置ON，复位微处理器，中止执行机器码；接管开关ON，则接收总线上的地址信号和数据信号。这时，可以使用A0～A15开关输入16位的存储器地址。标为D0～D7的灯用来显示该地址的8位内容。要写入一个新的字节到相应的地址，则应在D0～D7开关上设置该字节，然后把写入开关先拨到ON再拨到OFF。完成了向内存中写入相应字节以后，把接管开关设置为OFF，复位开关设置为OFF，则微处理器开始执行程序。

这就是如何向刚刚开头建成的计算机中输入第一个机器码程序的过程，不用说，这是很费事的。

### 程序输出显示在视频显示器

在上一章中已经讲到，只显示字符的视频显示器有1KB的随机访问存储器用来存放25行，每行40个字符的ASCII码。程序把内容写入到该存储器中，方法与写入到计算机中其他存储器中的方法一样。

然而，把程序的输出显示到视频显示器并不是那么简单。例如，如果一段程序执行结果是4Bh，则不能简单地把这个值写入视频显示器的存储器中。如果这样做，屏幕上将会看到的是字符K。正确的是写出两个ASCII码字符到显示器：34h（4的ASCII）和42h（B的ASCII）。8位的计算结果每半个字节是一个十六进制数字，该数字必须通过对应的ASCII码来显示。

当然，也可以写一段小的子程序来完成这种转换。下面的一段8080汇编语言程序用来把十六进制数中的一位转换成对应的ASCII码（假定包含的十六进制数范围从00h～0Fh）：

```assembly
NibbleToAscii: CMP A, 0Ah  ; 判断是数字还是字母
               JC Number
               ADD A, 37h  ; 把A～F转换成41h～46h
               RET
Number:        ADD A, 30h  ; 把0～9转换成30h～39h
               RET
```

下面的子程序调用NibbleToAscii两次，把累加器A中的一个字节转换成两个ASCII码数字，并放在寄存器B和C中：

```assembly
ByteToAscii:   PUSH PSW  ; 保存A
               RRC       ; A右移4次，取得高半字节
               RRC
               RRC
               RRC
               CALL NibbleToAscii ; 转换成ASCII码
               MOV B, A  ; 把结果放入寄存器B
               POP PSW   ; 取出原来的A
               AND A, 0Fh; 取低半字节
               CALL NibbleToAscii ; 转换成ASCII码
               MOV C, A  ; 结果放入寄存器C中
               RET
```

通常这些程序，可以把一个用十六进制表示的字节显示在视频显示器上。进一步来讲，如果想把它转换成十进制数，还需要做写别的工作。这个过程与把一个数从十六进制转换成十进制的过程（用10除以几次）十分相似。


