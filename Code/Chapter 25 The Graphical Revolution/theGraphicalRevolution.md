图形化革命
=========

1945年9月10日万尼瓦尔（Vannevar Bush 1890－1974）在《生活》（life）杂志中发表了一篇关于未来科学大胆猜想的文章《思维之际》（As We May Think）。文中描述了一种未来发明，这项发明可以帮助科学家和研究人员更轻松地处理日益增多的技术期刊及文章。布什提出可以利用微缩胶片作为解决方案，同时他构想出了一种叫做麦克斯存储器（Memex，又名记忆扩展器）的设备，它可以对书籍，文章，录音和图片进行保存。麦克斯存储器还有一项重要的功能，那就是它可以让用户根据某个主题在所有的素材之间建立关联，这些关联的基本来源就是我们人类视为。他还大胆预言一种新的职业群体，他们的工作就是在繁杂的信息载体之间提炼并建立起可靠的关联。

这个故事的主角是信息（Information），故事的主线是如何利用新技术成功的处理信息。

### 交互式

回顾历史，从第一台继电器计算器（1934）的出现到现在为止，65年过去了，计算机的体积越来越小，处理速度越来越快，价格也越来越便宜。

要充分利用日益增长的运算和处理能力，较好的一种方法就是不断改进计算机系统中的关键部位，最典型的就是用户界面（User Interface）——它可以看作人机交互的轴心。

在计算机发展的早期，交互式这个概念并没有它的实际意义。人们编程时更多使用的是开关和电缆，有一部分人使用的是打孔纸带或胶片。到了20实际50年代到60年代（有些观点认为这一时间可以延续到70年代），计算机已经可以使用批处理（batch processing）进行编程：程序和数据被“分布”在打孔卡上，然后一次性录入到计算机内存。这些工作完成之后，再由程序对数据进行分析，得出结论，最后将结果打印在纸上。

最早的交互式计算机运用的是电传打字机。我们回忆一下前面讲过的达特茅斯（Dartmouth）时分操作系统（原型出现于20世纪60年代中期），这种系统支持多个电传打字机同时工作，而且互不影响。此类系统中，用户在打字机上输入一行，计算机会相应地输出一行或多行。通常，打字机和计算机之间的信息交流是由一串ASCII码（也有可能是其他字符集）来完成的，这些ASCII码大多由字符编码组成，当然还包括像回车，换行等一系列简单的控制字符编码。随着机器的运行，相应的事务也随着打印纸的旋转逐步推进。

阴极射线管（cathode-ray tube, CRT,20世纪70年代随处可见的设备）并不受这类限制。使用软件来协调整个屏幕显得更加灵活方便——这可以算得上是一种二维的信息平台。但是为了尽可能保持操作系统显示输出的逻辑一致性，早期那些为小型计算机编写的软件都把CRT显示器看作“玻璃屏幕电传打字机”——所有内容都是一行一地显示的，当字符排到底端，屏幕被填满时，屏幕上的内容要整体向上翻滚。除了CP/M（微处理机操作系统）中的所有工具软件之外，大部分MS-DOS下的工具软件都采用这种方法——它们都仿照电传打字机的工作方式来使用视频显示器。使用电传打字机这种工作原理的操作系统有很多，或许UNIX才算是最典型的原型操作系统之一，它还保留着这种“传统工艺”。

不巧的是，ASCII码字符集不完全适用于阴极射线管的工作方式。在最原始的ASCII码设计中，编码1Bh被标识为Escape，它的主要作用是帮助字符集进行扩充。在1979年美国国家标准协会（American National Standards Institute，ANSI）发布了一项题为“ASCII码使用的附加控制（Additional Controls for Use with American National Standard Code for Information Interchange）”的标准。该标准发布的初衷是为了“适应二维字符——图像设备输入/输出控制中迫在眉睫的相关需求，其中包括阴极射线管和打印机之间的交互终端……”

其实Escape的编码1Bh只占据一个字节，且它的含义是唯一的。Escape如果作为一串序列的前缀字符，那么这串字符序列的含义也随之改变。比如下面这串序列：

```
1Bh 5Bh 32h 4Ah
```
可以看出Escape编码随后紧跟的是字符“［”“2”“J”的ASCII码，现在这一串字符的含义为“清屏”然后移动光标至左上角。这种定义在电传打字机上是不可能出现的。

下面这串序列：

```
1Bh 5Bh 35h 3Bh 32h 39h 48h
```
即Escape编码随后紧跟的是字符“［”“5”“；”“2”“9”“H”，这串字符的作用是把光标移到第5行的第29列。

键盘和CRT一起对远程计算机传输来的ASCII码（可能还包括Escape字符序列）做出响应，这种设备我们称之为哑终端（dumb terminal）。哑终端相对于电传打字机速度要更快，从某种程度来讲也更灵活，但从速度的提高程度来讲，并不足以引领用户界面的个革新。

真正的革新出现在20世纪70年代小型计算机中——它类似于第21章我们构建的假想计算机，配备了“视频显示存储器”，并作为微处理器地址空间的组成部分。

#### VisiCalc

第一个预示着家用计算机将与它的孪生兄弟——体积庞大，价格昂贵的大型机划分界限的标志的时间是VisiCalc的使用。VisiCalc由丹·布莱克林（Dan Bricklin，生于1951年）和鲍勃·弗兰克斯顿（Bob Frankston，生于1949年）设计并编程实现，而这套系统于1979年引入苹果II型电脑（Apple II）中。VisiCalc通过屏幕将一个二维电子数据表呈现给用户。在VisiCalc出现之前，数据表就是一张划分好了行，列的纸，主要用于一系列计算。VisiCalc用视频显示器将纸质材料取而代之，通过这种方式，用户可以在数据表中随处游走，在相应位置输入数据，公式，并在修改后对结果进行重新计算，为用户提供了更多自由。

#### IBM早期PC直接操控硬件输出字符

令我们惊讶与无奈的是，VisiCalc这狂应用程序无法在大型机上运行。因为像VisiCalc这类程序需要以较快的速度不断更新屏幕，所以，它们直接将数据写入Apple  II视频显示器所配备的RAM中。该RAM是微处理器地址空间的一部分。大型时分计算机以及哑终端之间的接口速度过慢，以至于电子报表程序无法使用。

计算机对键盘的响应速度越快，对视频显示器的更新速度越快，则人机交互就越频繁。在IBM PC机出现的头10年（20世纪80年代），为它编写的大多数软件是直接写入显示存储器的。由于IBM建立了一套硬件标准，其他计算机厂商追随这一标准，使得软件厂商可以绕过操作系统直接使用硬件而不用担心他们的软件在某些机器上不能正确运行（或根本不能运行）。

IBM PC所使用的早期的应用程序大多数只有字符输出而没有图形输出。使用字符输出同样能使得应用程序的执行速度加快。如果视频显示器设计得如第21章所描述的那样，则程序只需简单地把某个字符的ASCII码写入内存就可以在屏幕上显示出该字符。使用图形视频显示的程序需要写入8个或更多的字节到内存中才能画出文本字符的图形。

#### SAGE到黑白显示器

从字符显示到图形显示的变化是计算机革命中极其重要的一步，然而图形方式下计算机硬件和软件的发展比文本和数字方式下计算机硬件和软件的发展要慢的多。早在1945年，冯·诺依曼就设想了一种像示波器一样的显示器，可用来使信息图形化。但是，直到20世纪50年代早期，计算机图形才开始成为现实。当时麻省理工学院（得到IBM资助）建立了林肯实验室来开发计算机，用于美国空军的空中防卫系统。该项目称为SAGE（semi-automatic-groundenvironment）,有一个图形显示屏帮助操作员分析大量数据。

在SAGE这样的系统中使用的早期视频显示器不像今天我们在PC机中所用的显示器。今天普通的PC机显示器是光栅显示器。就像电视机，所有的图像由一系列水平光栅线组成，由一个电子枪射击光束很快地前后移动扫过整个屏幕形成光栅。屏幕可以看成是一个大的矩形点阵，这些点称为像素。在计算机里，一块内存专门供视频显示使用，屏幕上的每一个像素由1位或多位比特表示。这些二进制素质不仅决定了像素点的亮度，还决定了它的颜色。

例如，今天多数计算机显示器有至少水平方向640像素的分辨率，垂直方向480像素的分辨率，像素的总数是这两个数的乘积307200。如果1个像素只占用1位内存，则每个像素只局限于两种颜色，即通常的黑、白色。如，0像素为黑，1像素为白。这样的视频显示器需要307200位的内存，即38400字节。

随着可能的颜色数目的增多，每个像素需要更多的位，显示适配器也需要更多的内存。例如，每个像素可以用一个字节来编码灰度。按照这样的安排，字节00h为黑，FFh为白，之间的值代表不同的灰度。

#### CRT的色彩显示

CRT上的彩色由三个电子枪产生，每一个分别负责三原色红、绿、蓝中的一种（可以用放大镜来观察电视机或彩色计算机屏幕以验证它的正确性。由不同的原色组合来显示图像），红色和蓝色的组合是品红色，红色与绿色的组合是黄色，蓝色和绿色的组合是青色，三原色的组合是白色。

最简单的彩色图像显示适配器每个像素需要3位。像素可以如以下这样编码，每一个原色

| 比特 | 色彩 |
| ---- | ---- |
| 000  | 黑   |
| 001  | 蓝   |
| 010  | 绿   |
| 011  | 青   |
| 100  | 红   |
| 101  | 品红 |
| 110  | 黄   |
| 111  | 白   |

但是，这种方式只适合于简单的类似卡通画的图像。许多现实世界中的颜色都是红、绿、蓝按不同色阶（levels）组合而成的。如果用2个字节来表示一个像素，则每一个原色可分配5位（1位保留），这样可以给出红、绿、蓝三种颜色各32种不同的级别，即总共可有32768种不同的颜色。这种模式通常称作高彩色（high color）或千种颜色（thousands of colors）。

我们下面尝试一下用3个字节来表示一个像素，三原色中的每一种各占一个字节。这种编码模式使红、绿、蓝三种颜色各有256种不同的级别，这样总共有16777216种不同的颜色，通常称作全彩色（full color）或百万种颜色（millions of colors）。如果视频显示器的分辨率为水平640像素，垂直480像素，则总共需要921600字节的存储容量，即将近1M字节。

每个像素所赋予的比特数有时也称作色深（color depth）或色彩分辨率（color resolution）。颜色数与单个像素被赋予的比特数的关系如下：



如果视频适配卡配备的存储器容量有限，那么它的最大色深或色彩分辨率自然而然也受到约束。假设有一个配备了1MB存储器的视频适配卡，在每个像素被赋予3个字节的情况下分辨率可以达到640x480.如果想把分辨率提高到800x600，存储器就不足以为每个像素赋予3个字节，必须缩减到用2个字节来表示一个像素。

#### 光笔和鼠标

尽管现在使用光栅显示器似乎是理所当然的，但在早期由于需要大量存储器，使用光栅显示器就不太实际。SAGE视频显示器是矢量显示器，比电视机更像示波器。电子枪可以定位到显示器上任何部分的点，并且直接画出直线或曲线。利用屏幕上图像的可持续性使得能用这些直线和曲线来形成最基本的画面。

支持光笔(light pen)是SAGE计算机的一大特色，操作者使用光笔可以改变显示器上的图像。光笔是特殊的设备，看起来像一只铁笔，一端连有电线。运行适当的软件后，计算机可以检测到光笔指向的屏幕位置，并随着光笔的移动而改变图像。

光笔的工作原理是什么呢？即使是技术专家，在第一次看到光笔的时候也会迷惑不解。关键在于光笔不发射（emit）光——它检测（detect）光。在CRT中（无论是用光栅还是向量显示），控制电子枪移动的电路也可以确定从电子枪射出的光何时打到光笔上，从而确定光笔正指向屏幕的什么位置。

伊凡·苏泽兰（Van Sutherland，生于1938年）是最早预见到就是啊 u 年纪发展的一个全新领域，即交互式计算的人之一。他在1963年示范了一个他为SAGE计算机开发的名为Sketchpad（画板）的具有革命性意义的图形程序。画板可以存放图像信息到存储器，并且可以把图像显示在屏幕上。另外，还可以用光笔在显示器上画图并修改，同时计算机会对光笔的轨迹一直进行跟踪。

另外一个交互式计算的设想家是道格拉斯·恩格尔巴特（Douglas Engelbart生于1925年)。他曾读过1945年万·布什（Vannevar Bush）发表的文章《As We May Think》（思维之际），并在5年后开始用一生的时间致力于研究新的计算机界面。20世纪60年代中期，当他在Sanford研究院时，他彻底重新考虑了输入设备，提出了用五股（five-pronged)的键盘(此设备没有流行)以及一个他叫作鼠标的有轮子和按钮的小设备来输入命令。鼠标现在已广泛用来移动屏幕上的指针，以选择屏幕上的对象。

#### Alto与图形用户界面

恰逢光栅显示器在经济上切实可行，许多早期的热衷于交互式图形计算的人们（尽管没有恩格尔巴特）也已聚集在Xerox（施乐）公司里。Xerox公司于1970年建立了PaloAlto（阿尔托研究所）研究中心（PARC），其中一项就是资助开发产品，以使得公司能进入计算机界。也许PARC最著名的设想家是阿伦·凯（Alan Kay，生于1940年），当他14岁的时候碰巧看到了罗伯特·海因莱因（Robert Heidein）的小故事里描述的万·布什（Van Bush）的微缩胶片图书馆，并已设想了一种他称为Dynabook的轻便计算机。

PARC的第一个大工程是Alto，于1972年～1973年期间设计和制造出来。按照那个年代的标准，这是一个给人深刻印象的产品。它采用落地式的系统单元，有16位处理器、2个3MB的磁盘驱动器、128KB内存（可以扩充到512KB），以及一个三个按钮的鼠标。在16位单片微处理器之前出现，Alto的处理器由大约200个集成电路组成。

Alto的视频显示器是它与众不同的地方之一。屏幕的大小和形状与一张纸差不多—8英寸宽10英寸高。它以光栅图形模式工作，有606个水平像素和808个垂直像素，这样总共489648个像素。每个像素占1位存储器，即每个像素不是黑色就是白色。用于视频显示的存储器容量是64KB，占用部分处理器的地址空间。

通过写入到视频显示存储器，软件可以在屏幕上画出图画或显示不同字体和大小的文本。通过在桌上滚动鼠标，用户可以在屏幕上定位指针，与屏幕上的对象进行交互。视频显示器并非像电传打字机那样按行显示用户输入，按行写出程序输出。视频显示器的屏幕是一个二维的、高密度的信息阵列和更直接的用户输入源。

20世纪70年代晚期，Alto所搭配的程序逐渐凸显出很多新奇有趣的特点。比如窗口中可以容纳多个程序并同时显示在屏幕上。Alto的视频图像功能使得软件从文本的束缚中摆脱出来，使其可以更加真实地反映用户的想法。图形对象（Graphical object，比如按钮，菜单，以及被称作图标的小图片）成为用户接口的一员。鼠标可以在多个窗口中进行选择，触发图形对象来执行程序功能。

软件的内涵就在于此，它的意义远不止仅有的用户接口，还包括与用户的亲密耦合。软件使得计算机所涵盖的应用领域变得更广，而不仅仅局限于简单的数字变换。软件之所以被设计出来，其最终目的是——引用道格拉斯·恩格尔巴特在1963年发表的一篇论文的标题——《为了扩展人类的智慧》（For the Augmentation of Man's Intellect)。

PARC在Alto这个项目的开发成果预示着图形用户界面（Graphic User Interface，GUI）登上了历史的舞台。但Xerox公司并没有销售Alto（如果要销售的话，价格将在3万美元以上）。经过10多年，高售价的思想体现在一种成功的消费品上。

#### 图形操作系统

1979年,Steve Jobs和来自苹果计算机公司的小组参观了PARC，看到的东西给他们留下了深刻的印象。但是，他们花费了三年多的时间才推出了具有图形接口的计算机，这就是1983年1月推出的不太受欢迎的Apple Lisa。而在1年以后，苹果公司就推出了很成功的Macintosh。

最初的Macintosh配备有Matorola6800微处理器、64KB的ROM、128KB的RAM、一个3.5英寸的磁盘驱动器（可以存储400KB）、一个键盘、一个鼠标和一个视频显示器。该视频显示器水平512个像素，垂直342个像素（CRT测量对角只有9英寸），总共175104个像素。每一个像素用1位内存，颜色为黑、白，这样视频显示RAM大约需要22KB。

最初的Macintosh硬件做得很好，但是很难进行变革。1984年，出现了使Mac与其他计算机完全不同的Macintosh操作系统，那时通常称作系统软件，后来称为Mac OS.

基于文本的单用户操作系统，如CP/M或MS-DOS，体积很小但是不支持扩展的应用程序接口（API）。关于这点在第22章进行过解释，在这些基本文件的操作系统中，没有为访问文件系统的应用程序提供一种渠道。Mac OS这种图形化操作系统所占的空间比前面提到的这两种要大得多，其中包含了上百个API函数，每一个函数都用其功能来命名。

像MS-DOS这样的基于字符的操作系统只需提供几个简单的API函数就能使得应用程序在屏幕上以电传打字机方式显示字符，但Mac OS这样的图形操作系统必须提供一种方法才能使得程序可以在屏幕上显示图形。从理论上来讲，可以通过实现一个API函数来完成，该函数使得应用程序可以设置某个水平和垂直坐标的像素的颜色。但是，实际证明这种方法效率不高且图形显示的速度很慢。

因而由操作系统提供完整的图形编程系统就显得非常有意义，这意味着操作系统需包含有画线、画矩形、画椭圆（包括圆）和字符的API函数。线可以由实线或虚线或点组成；矩形和椭圆可以用不同的填充模式来填充；字符可以显示成不同字体和大小并具有不同效果，如：加粗和下划线等。图形系统负责确定如何在显示器上把这些图形对象作为点阵来显示。

如果程序在图形操作系统下运行，那么它们在显示器或打印机上画图这一过程中，使用的是一套完全相同的API。正因为如此，字处理软件在屏幕上显示出的文档，与打印出来得到的纸质文档，看上去非常相似。这种特点称为“所见即所得”（简写为WYSUWYG）。

图形用户界面对用户而言是极具吸引力的，其中一个重要原因就是不同的应用程序使用着大致相同的工作原理，并且影响着用户的使用经验。这样一来，操作系统就承担起了支持API函数的重任，而应用程序就可以利用这些API函数去实现用户界面的不同组件，如按钮和菜单等。GUI不仅是一种看上去简洁友好的用户环境，对于程序员而言，它还是一种重要的开发环境。程序员在开发新一代用户界面的时候可以不用从底层开始重新编写。

#### Windows

在Macintosh推出之前，几家公司就已开始创建用于IBM PC及其兼容机的图形操作系统。从某种意义上来讲，Apple开发人员的工作要容易一些，因为他们硬件和软件一起设计。Macintosh系统软件只支持一种类型的磁盘驱动器，一种类型的视频显示器和两种打印机。但在PC上实现的图形操作系统需要支持许多不同的硬件。

另外，尽管IBMPC很早（1981年）就已推出了，但多数人已习惯于用他们喜好的MS-DOS应用程序且没有准备放弃它们。PC机的图形操作系统需要考虑的一个重要方面是，要使得MS-DOS应用程序的运行就像是专门为新的操作系统设计的应用程序一样。（Macintosh上就根本不能运行AppleII软件，因为它采用了不同的微处理器。）

1985年，迪吉多科研公式（Digital Research公司，CP/M的后续公司）推出了GEM（图形环境管理器）；Visicorp公司(销售Visilalc的公司)推出了VisiOn；Microsoft公司发布了Windows1.0版，它很快被认为是“视窗战争”中最有可能的胜利者。然而，直到1990年3月发布Windows3.0，Windows才开始吸引大量的用户。从那时起，它的普及率不断提高。到今天，已有大约90%的微机上使用的操作系统是Windows。Macintosh和Windows除了具有相同的外在表现外，它们的API是非常不同的。

理论上讲，除了图形显示外，图形操作系统并不比字符操作系统需要更多的硬件，甚至不需要硬盘驱动器。最初的Macintosh没有，Windows1.0也不需要。Windows1.0甚至不需要鼠标，尽管每个人都认为用鼠标操作更容易一些。



